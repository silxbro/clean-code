# 이 모든 것을 테스트로 해결할 수는 없는가?
<br/>

예상을 벗어나는 코드를 방지하기 위한 코드 품질 향상 노력에 반대하는 주장을 하는 사람들이 가끔 있다.
테스트가 이러한 모든 문제를 잡아낼 것이기 때문에 이런 노력은 시간 낭비라는 것이다. 필자의 경험으로 볼 때, 이것은 현실에서는 별로 효과가 없는 다소 이상주의적인 주장이다.

코드를 작성하는 그 시점에는 코드를 어떻게 테스트할지 제어할 수 있다.
모든 테스트 케이스를 다 처리하고 테스트 관련 지식이 풍부하며 코드에 대한 모든 올바른 행동과 가정을 확인하는, 거의 완벽한 테스트 코드를 작성할 수 있다.
그러나 예상을 벗어나는 코드를 피하는 것은 여러분이 작성한 코드에 대한 기술적 정확성 때문만은 아니다.
다른 개발자가 여러분의 코드를 사용해 코드 작성을 할 때 역시 그 코드가 올바르게 작동하도록 하기 위한 작업이다.
다음과 같은 이유로 인해 테스트만으로는 이것을 보증하기에 충분하지 않을 수 있다.

- 어떤 개발자들은 테스트에 대해 그다지 부지런하지 않을 수도 있다.
  즉, 여러분의 코드에 대해 자신이 가정한 것이 틀렸다는 것을 드러내기 위해 충분한 시나리오나 코너 케이스를 테스트하지 않는다.
  특정 시나리오 혹은 매우 큰 입력에서만 문제가 드러나는 경우 이런 상황이 가능하다.
- 테스트가 항상 실제 상황을 정확하게 시뮬레이션하는 것은 아니다. 코드를 테스트하는 개발자는 의존 라이브러리를 목(mock) 객체를 통해 테스트해야 할 수도 있다.
  이 경우 목 객체가 어떻게 행동할 것인지 자신이 **생각하는 바대로** 프로그래밍한다.
  실제 코드가 개발자의 가정과 예측을 벗어나는 방식으로 동작하지만 개발자가 이를 깨닫지 못한다면, 목 객체 자체를 올바르게 프로그래밍하지 못한다.
  이런 일이 일어난다면 예상을 벗어나는 동작 때문에 발생하는 버그는 테스트를 통해 찾아내기가 어렵다.
- 어떤 것들은 테스트하기가 매우 어렵다. 부수 효과에 대한 절에서 다중 스레드 코드와 관련해 어떻게 문제가 될 수 있는지 살펴봤다.
  멀티스레딩 문제와 관련된 버그는 종종 낮은 확률로 발생하고, 어느 정도 큰 규모에서 실행될 때만 나타날 수 있어서 테스트하기 어렵기로 악명 높다.

이 사항들은 코드를 오용하기 어렵게 만드는 것과 관련해서도 동일하게 적용된다.

다시 한번 강조하자면 테스트는 매우 중요하다. 아무리 많은 코드 구조화나 코드 계약에 대한 걱정도 고품질의 철저한 테스트를 대체할 수 없다.
그러나 필자의 경험상 그 반대 역시 사실이다. 직관적이지 않거나 예상을 벗어나는 코드에 숨어 있는 오류를 테스트만으로는 방지하기 어렵다.
