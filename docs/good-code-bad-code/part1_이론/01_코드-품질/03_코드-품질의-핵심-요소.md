# 코드 품질의 핵심 요소
<br/>

방금 살펴본 네 가지 목표는 우리가 근본적으로 성취하고자 하는 것에 초점을 맞추는 데는 도움이 되지만, 일상적 업무로 하는 코딩 작업과 관련해서는 특별한 조언을 제공하지는 않는다.
이러한 목표에 부합하는 코드를 작성하는 데 도움이 될 보다 구체적인 전략을 파악하는 것이 유용하다.
이 책은 여섯 가지 전략을 중심으로 진행될 것이며, 필자는 이를 (과장된 용어로) '코드 품질의 여섯 가지 핵심 요소'라고 부른다.
각 요소에 대한 높은 수준의 설명부터 시작하겠지만, 이후의 장에서는 일상의 코딩 업무에 어떻게 적용할 수 있을지를 보여주는 구체적인 예를 제시할 것이다.
코드 품질의 여섯 가지 핵심 요소는 다음과 같다.

1. 코드는 읽기 쉬워야 한다.
2. 코드는 예측 가능해야 한다.
3. 코드를 오용하기 어렵게 만들라.
4. 코드를 모듈화하라.
5. 코드를 재사용 가능하고 일반화할 수 있게 작성하라.
6. 테스트가 용이한 코드를 작성하고, 제대로 테스트하라.

## 1. 코드는 읽기 쉬워야 한다
코드를 읽을 때 다음과 같은 사항을 이해하기 위해 애쓸 것이다.

- 코드가 하는 일
- 어떻게 그 일을 수행하는지
- (입력이나 상태 등) 어떤 것을 필요로 하는지
- 코드 실행 결과물

코드를 작성하고 난 후 어느 시점이 되면 다른 개발자가 그 코드를 읽고 이해해야 하는 상황이 반드시 온다.
코드가 병합되기 전에 코드 검토를 받아야 한다면, 그 일은 코드 작성 후 바로 일어날 것이다.
하지만 코드 검토를 무시하더라도, 어느 순간 누군가가 자신의 코드를 이해하려고 애쓰는 상황이 오기 마련이다.
예를 들어 요구 사항이 변경되거나 디버깅이 필요할 때 그런 상황이 올 수 있다.

코드의 가독성이 떨어진다면, 다른 개발자가 그 코드를 이해하는 데 많은 시간을 들여야 한다.
또한, 코드의 기능에 대해 잘못 이해하거나 몇 가지 중요한 세부 사항을 놓칠 가능성 역시 크다.
이런 일이 일어난다면 코드 검토 중에 버그를 발견할 가능성이 작고, 새로운 기능을 추가하기 위해 다른 사람이 코드를 수정할 때 새로운 버그가 도입될 가능성이 크다.
소프트웨어가 수행하는 모든 일은 그것을 가능하게 하는 어떤 코드에 의해 일어난다.
그 코드가 무엇을 하는지 개발자가 이해하지 못하면, 소프트웨어 전체가 제대로 작동하는 것은 거의 불가능에 가깝다.
레시피와 마찬가지로 코드도 읽을 수 있어야 한다.

- 2장 : 올바른 추상화 계층을 정의하는 것이 코드의 가독성에 어떻게 도움이 되는지 살펴본다.
- 5장 : 코드의 가독성을 높이는 여러 가지 구체적인 기법을 다룬다.

## 2. 코드는 예측 가능해야 한다
우리의 코드를 사용하는 다른 개발자는 이름, 데이터 유형, 일반적인 관행과 같은 단서를 사용해 코드가 입력값으로 무엇을 예상하는지, 코드가 무슨 일을 하는지,
그리고 무엇을 반환하는지에 대한 정신 모델을 구축한다.
이 정신 모델과 어긋나는 어떤 일이 코드에서 일어나면, 이로 인해 버그가 아무도 모르게 코드 내로 유입되는 일이 너무도 많이 일어난다.

이런 상황은 일부 코드가 예상과는 벗어나는 일을 수행할 때 소프트웨어 시스템에서 일어나는 상황과 유사하다.
즉, 코드의 사용자는 그 코드에 의해 일어날 일을 예상하지 않고 있기 때문에 그 일이 실제로 일어날 줄 알지 못한 채 작업을 진행한다.
많은 경우에 잠시 동안은 문제가 없는 것처럼 보일 수 있다. 그러나 나중에 프로그램이 잘못된 상태에 놓이거나, 이상한 값이 사용자에게 반환되어 심각한 상황을 초래할 수 있다.

도움이 되거나 똑똑한 일을 수행하는 코드를 작성할 때, 아무리 좋은 의도를 가지고 있더라도 예상을 벗어난 동작을 수행하는 위험이 있을 수 있다.
코드가 예상에서 벗어나는 일을 한다면, 그 코드를 사용하는 개발자는 그 상황을 알지 못하거나 그 상황에 대처할 생각을 하지 못할 것이다.
이로 인해 문제의 코드와는 전혀 상관없어 보이는 부분에서 명백하게 이상한 일이 발견되기 전까지 시스템은 계속 비정상적으로 작동한다.
이런 코드는 사소한 오류를 일으킬 수도 있지만, 어떤 경우에는 중요한 데이터가 손상되는 재앙과도 같은 상황을 초래할 수 있다.
코드가 예상을 벗어나는 일을 수행하지는 않는지 주의 깊게 살펴야 하고, 할 수 있다면 그런 코드를 작성하지 않도록 노력해야 한다.

- 3장 : 코드 계약에 대한 세심한 주의가 예측 가능한 코드를 작성하는 데 도움이 되는 근본적인 기술임을 살펴본다.
- 4장 : 오류를 다루는데, 코드에서 이런 오류가 제대로 전달되지 않거나 적절하게 처리되지 않으면 이 역시 예상을 벗어나는 코드가 될 수 있다.
- 6장 : 예상을 벗어난 동작을 수행하는 코드를 피하기 위한 구체적인 기술 몇 가지를 살펴본다.

## 3. 코드를 오용하기 어렵게 만들라
자신이 작성하는 코드는 종종 다른 코드에 의해 호출된다. 자신의 코드를 작성할 때 다른 코드가 어떤 것을 '꽂기'를 기대한다.
즉, 호출할 때 인수가 입력되거나 시스템에 특정 상태에 있을 것을 예상한다. 자신이 작성한 코드에 잘못된 것들이 꽂히면, 모든 것이 폭발할 수 있다.
시스템은 작동을 멈추고, 데이터베이스가 영구적으로 손상되거나, 중요한 데이터가 손실될 수 있다. 큰 문제가 일어나지는 않더라도 코드가 작동하지 않을 가능성이 크다.
자신이 작성한 코드가 호출된 데는 이유가 있는데, 그 코드가 잘못 사용된다면 중요한 일이 수행되지 않거나, 이상하게 동작하지만 눈에 띄지 않는다는 것을 의미할 수도 있다.

코드를 오용하기 어렵거나 불가능하게 하면 코드가 작동할 뿐만 아니라 계속해서 잘 작동할 가능성을 극대화할 수 있다.

- 3장 : 코드 계약을 다루는데, (예상 가능한 코드 작성과 유사하게) 코드의 오용을 어렵게 만드는 데 도움이 될 수 있는 근본적인 기술이다.
- 7장 : 코드를 오용하기 어렵게 만들기 위한 구체적인 기술을 다룬다.

## 4. 코드를 모듈화하라
모듈화는 개체나 시스템의 구성 요소가 독립적으로 교환되거나 교체될 수 있음을 의미한다.
모듈화된 시스템의 주요 특징 중 하나는 인터페이스가 잘 정의되어 서로 다른 구성 요소 간 상호작용하는 지점이 최소화된다는 점이다.

소프트웨어 시스템과 코드베이스는 외부에 의존하지 않고 실행할 수 있는 모듈로 나누는 것이 이로울 때가 많다.
이때 두 개의 인접한 모듈 사이의 상호작용은 한 곳에서 일어나고 잘 정의된 인터페이스를 사용한다.
이렇게 하면 변화하는 요구 사항에 더 쉽게 적응할 수 있는 코드를 작성하는 데 도움이 된다. 왜냐하면 한 가지 기능을 변경한다고 해서 다른 부분까지 변경할 필요가 없기 때문이다.
모듈화된 시스템은 일반적으로 이해하기 쉽고 추론하기 쉬운데, 기능이 관리 가능한 단위로 나누어지고 기능 단위 간 상호작용이 잘 정의되고 문서화되기 때문이다.
코드가 모듈화되어 작성되면 처음에 작동이 시작되고 그 후에도 계속해서 잘 작동할 가능성이 커진다. 왜냐하면 코드가 하는 일을 개발자들이 오해할 소지가 적기 때문이다.

- 2장 : 간결한 추상화 계층이 좀 더 모듈화된 코드를 작성하기 위한 근본적인 기술이라는 것을 살펴본다.
- 8장 : 코드를 모듈화하기 위한 여러 가지 구체적인 기법을 논의한다.

## 5. 코드를 재사용 가능하고 일반화할 수 있게 작성하라
재사용성과 일반화성은 유사하지만 약간 다른 개념이다.

- **재사용성**(reusability)은 어떤 문제를 해결하기 위한 무언가가 여러 가지 다른 상황에서도 사용될 수 있음을 의미한다.
- **일반화성**(generalizability)은 개념적으로는 유사하지만 서로 미묘하게 다른 문제들을 해결할 수 있음을 의미한다.

코드는 만들어 낸느 데 시간과 노력이 필요하며, 일단 만들어지면 유지보수에 지속적인 시간과 노력이 들어간다. 코드를 작성하는 일이 위험이 없는 것은 아니다.
아무리 조심한다고 해도 코드에는 버그가 포함될 수 있고, 코드를 더 많이 작성할수록 더 많은 버그가 생길 것이다.
여기서 중요한 것은 코드베이스에서 코드 라인이 적을수록 좋다는 것이다.
전문 개발자는 코드를 작성하고 이에 대한 대가를 받는 것이기 때문에 코드 라인이 적어야 한다는 말이 이상하게 들릴 수 있다.
하지만 실제로 우리는 코드를 많이 작성한 것에 대한 대가를 받는 것이 아니라 문제를 해결한 것에 대한 대가를 받는 것이다. 코드는 문제 해결을 위한 수단일 뿐이다.
노력을 덜 기울이면서도 문제를 해결하고, 버그로 인해 의도치 않게 다른 문제를 일으킬 가능성을 줄일 수 있다면 그것은 대단한 것이다.

코드가 재사용할 수 있고 일반화되어 있으면 우리(및 다른 사람들)는 그 코드를 코드베이스의 여러 부분에서, 그리고 하나 이상의 상황에서 사용할 수 있고, 여러 가지 문제를 해결할 수 있다.
이런 코드는 시간과 노력을 절약해주고 더 신뢰할 수 있는데, 그 이유는 실제 서비스 환경에서 이미 시도되고 테스트된 논리를 재사용하기 때문이다.
즉, 어떤 버그라 할지라도 이미 발견되고 해결되었을 가능성이 크다는 것을 의미한다.

코듈화된 코드 역시 더 높은 재사용성과 일반화성을 갖는다. 모듈화와 관련된 장은 재사용성과 일반화성에 관한 주제와 함께 진행된다.
- 9장 : 코드를 보다 재사용할 수 있고 일반화하기 위한 여러 가지 기술과 고려 사항을 다룬다.

## 6. 테스트가 용이한 코드를 작성하고 제대로 테스트하라
앞서 소프트웨어 개발 및 배포 다이어그램에서 보았듯이 버그와 제대로 동작하지 않는 기능을 가지고 있는 코드가 실제 서비스 환경에서 실행되지 않도록 하는 프로세스에서
테스트는 중요한 부분을 차지한다. 테스트는 이 프로세스에서 두 가지 핵심 사항에 대한 주된 방어 수단이 될 때가 많다.

- 버그나 제대로 동작하지 않는 기능을 갖는 코드가 코드베이스에 병합되지 않도록 방지
- 버그나 제대로 동작하지 않는 기능을 갖는 코드가 배포되지 않도록 막고 서비스 환경에서 실행되지 않도록 보장

따라서 테스트는 코드가 동작하고, 멈추지 않고 계속 잘 실행하도록 보장하기 위해 필수적인 부분이다.

소프트웨어 개발에서 테스트가 얼마나 중요한지는 아무리 강조해도 지나치지 않다. 독자들은 이에 대해 이미 여러 번 들어봤을 것이기 때문에, 진부한 것이라고 무시해 버리기 쉽다.
하지만 테스트는 정말 중요하다. 이 책 여러 부분에서 살펴보겠지만, 다음과 같은 이유에서다.
- 소프트웨어 시스템과 코드베이스는 너무 크고 복잡해 한 사람이 모든 세부 사항을 알 수 없고,
- (매우 똑똑한 개발자라 해도) 사람은 실수를 하는 존재다.

이는 많든 적든 사실이며, 테스트로 코드의 기능을 견고하게 만들지 않으면 이 문제들은 한꺼번에 발생할 수 있다.

코드 품질의 핵심 요소 중 이 항목은 제목에 '테스트가 용이한 코드를 작성하라'와 '제대로 테스트하라'라는 두 가지 중요한 개념이 포함되어 있다.
테스트와 테스트 용이성은 서로 관련은 있지만 고려하는 사항이 다르다.

- #### 테스트(test)
  이름에서 알 수 있듯이 코드 혹은 소프트웨어 전체를 테스트하는 것과 관련이 있다. 테스트는 수동이나 자동으로 수행된다.
  개발자는 일반적으로 테스트 코드를 통해 '실제' 코드를 돌려보고, 모든 것이 정상적으로 작동하는지 확인하고, 이것을 자동화하기 위해 노력한다.
  여러 가지 수준의 테스트가 있는데 가장 흔히 볼 수 있는 테스트는 다음과 같은 세 가지다.
  (이 세 가지가 모든 테스트를 나타내는 것은 아니다. 테스트를 분류하는 방법은 여러 가지가 있으며 종종 다른 이름을 사용한다).
  - #### 단위 테스트(unit test)
    일반적으로 개별 함수나 클래스와 같은 작은 단위의 코드를 테스트한다.
    단위 테스트는 개발자가 일상 코딩에서 가장 자주 작업하는 수준의 테스트이고 이 책에서 유일하게 자세히 다룰 수 있는 수준의 테스트다.
  - #### 통합 테스트(integration test)
    시스템은 일반적으로 여러 구성 요소, 모듈, 하위 시스템으로 구성된다. 이러한 구성 요소와 하위 시스템을 함께 연결하는 과정을 통합(integration)이라고 한다.
    통합 테스트를 통해 이러한 여러 구성 요소들이 제대로 작동하고 멈추지 않고 계속 실행하는지 확인할 수 있다.
  - #### 종단간(end-to-end, E2E) 테스트
    이 테스트는 처음부터 끝까지 전체 소프트웨어 시스템에서 작동의 흐름(또는 워크플로우)을 테스트한다.
    테스트하는 소프트웨어가 온라인 쇼핑몰이라면 웹 브라우저를 자동으로 구동하고 사용자가 구매를 완료하는 데까지 진행할 수 있는지 테스트하는 것이 E2E 테스트의 예다.
- #### 테스트 용이성(testability)
  이것은 (테스트 코드와 반대로) 테스트 대상이 되는 '실제' 코드를 가리키며 해당 코드가 얼마나 테스트하기 적합한지를 나타낸다.
  테스트 용이성은 서브시스템이나 시스템 수준에도 적용될 수 있다. 테스트 용이성은 모듈화와 깊은 관련이 있으며, 모듈화된 코드(또는 시스템)는 테스트 용이성이 더 좋다.
  코드의 테스트 용이성이 낮으면 제대로 테스트하는 것이 불가능할 수 있다.
  현재 작성 중인 코드의 테스트 용이성을 확인하기 위해 코드를 작성하면서 '어떻게 테스트할 것인가?'를 계속 자문하는 것이 좋다.
  즉, 코드를 다 작성하고 나서 테스트에 대해 생각해서는 안 된다. 테스트는 코드 작성의 모든 단계에서 필수적이고 기본적인 부분이다.
<br/>

- 10장, 11장 : 모두 테스트에 관한 것이며, 테스트는 코드 작성에서 매우 필수적이기 때문에 이 책 전체에 걸쳐 전반적으로도 다룬다.

### [테스트 중심 개발]
테스트는 코드 작성에 매우 필수적이기 때문에 어떤 개발자들은 코드를 작성하기 전에 테스트 코드부터 작성해야 한다고 주장한다.
이는 TDD(test-driven development)가 지지하는 관행 중 하나다. (10장(10.5절)에서 자세히 논의)
